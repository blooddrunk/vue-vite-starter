var a=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;import{_ as s}from"./BaseInput.8bf185c2.js";import{_ as l}from"./AppLogo.9891aef4.js";import{d as r,a9 as i,n,l as o,aa as c,ab as d,ac as u,ad as m,ae as p,af as w,ag as _,ah as f,E as v,ai as g,aj as b,o as h,a as y,e as x,f as j,w as k,a5 as O,L as q,a4 as S,c as E,a7 as I,t as L,ak as $,al as C,am as F,an as P}from"./vendor.cae3e354.js";import{_ as W,u as z}from"./index.a2230fa5.js";import"./useFormField.4fd7f0e2.js";var A={root:"_root_hgepb_2",formWrapper:"_formWrapper_hgepb_9",captcha:"_captcha_hgepb_16"},B={};const D={class:"tw-flex-grow tw-hidden lg:tw-flex tw-flex-col tw-items-center tw-justify-center"},M=x("img",{class:"tw-mt-16",src:"/vue-vite-starter/assets/login.1735a6c8.png",alt:"login background"},null,-1),R={class:"tw-py-6 tw-w-80 2xl:tw-w-88 tw-px-10 2xl:tw-px-14 tw-shadow tw-rounded-md tw-bg-white"},V=x("header",null,[x("h3",{class:"tw-text-primary tw-font-semibold tw-text-xl tw-text-center tw-tracking-widiest"}," 用户登录 ")],-1),G={class:"el-input__icon"},H={class:"el-input__icon"},J={class:"tw-grid tw-grid-cols-3 tw-gap-x-1"},K={class:"tw-col-span-2"},N={class:"el-input__icon"},Q={class:"tw-h-[40px]"},T=["src"],U={key:1},X=r({setup(r){const W=z(),{isLoggedIn:A,isLoginPending:B,loginError:X,hasLoginError:Y}=i(W),Z=n((()=>B.value?"登录中...":"登 录")),aa=o(!1),ea=o(""),ta=o(),sa=()=>{ea.value=`/captcha?_r=${Date.now()}`};sa();const la=()=>{sa()};c((()=>{ta.value&&(ta.value.onload=()=>{aa.value=!1},ta.value.onerror=()=>{aa.value=!0})})),d((()=>{Y.value&&la()}));const{values:ra,meta:ia,isSubmitting:na,handleSubmit:oa}=u({validationSchema:{username:"required",password:"required",captcha:"required"},initialValues:{username:"",password:"",captcha:""}}),ca=n((()=>!ia.value.valid&&ia.value.dirty)),da=n((()=>ca.value||na.value)),{start:ua,stop:ma}=m((()=>{A.value&&!fa.value&&va()}),2e3,{immediate:!1}),pa=oa((async a=>{fa.value=!1,await W.login(a),ua()})),wa=p(),_a=w(),fa=o(!1),va=async()=>{if("sign-in"!==_a.name||fa.value)return;W.isForcedOut=!1,fa.value=!0,ma();const s=_a.query,{from:l}=s,r=((s,l)=>{var r={};for(var i in s)e.call(s,i)&&l.indexOf(i)<0&&(r[i]=s[i]);if(null!=s&&a)for(var i of a(s))l.indexOf(i)<0&&t.call(s,i)&&(r[i]=s[i]);return r})(s,["from"]);await wa.push({name:String("sign-in"!==l&&l?l:"index"),query:r}),la()};return _(ra,(()=>{Y.value&&(X.value="")})),(a,e)=>{const t=l,r=f,i=$,n=s,o=C,c=F,d=P,u=v,m=g,p=b;return h(),y("div",{class:S([a.$style.root,"tw-h-screen tw-relative tw-flex tw-bg-primary"])},[x("div",D,[j(t,{size:"large"}),M]),x("div",{class:S(a.$style.formWrapper)},[j(t,{size:"large",class:"lg:tw-hidden tw-mb-20"}),x("div",R,[V,j(O,{"enter-active-class":"animate__animated animate__fadeIn","leave-active-class":"animate__animated animate__bounceOut animate__fast",mode:"in-out"},{default:k((()=>[q(X)?(h(),E(r,{key:0,class:"tw-mt-6",title:q(X),type:"error",effect:"dark",closable:!1},null,8,["title"])):I("",!0)])),_:1}),j(p,{class:"tw-mt-6","status-icon":"",onSubmit:q(pa)},{default:k((()=>[j(n,{name:"username",label:"用户名","show-label":!1,required:"",placeholder:"手机号/账号",clearable:""},{prefix:k((()=>[x("div",G,[j(i)])])),_:1}),j(n,{name:"password",label:"密码","show-label":!1,required:"",placeholder:"密码",clearable:"",type:"password"},{prefix:k((()=>[x("div",H,[j(o)])])),_:1}),x("div",J,[x("div",K,[j(n,{name:"captcha",label:"验证码","show-label":!1,required:"",placeholder:"验证码",clearable:""},{prefix:k((()=>[x("div",N,[j(c)])])),_:1})]),x("div",Q,[j(O,{"enter-active-class":"animate__animated animate__fadeIn animate__faster","leave-active-class":"animate__animated animate__fadeOut animate__faster",mode:"out-in"},{default:k((()=>[aa.value?(h(),y("div",{key:0,class:"tw-h-full tw-flex tw-items-center tw-justify-center tw-text-yellow-300 tw-text-xs tw-cursor-pointer",onClick:la}," 加载失败 ")):(h(),y("img",{key:1,ref_key:"captchaRef",ref:ta,class:"tw-rounded-sm tw-cursor-pointer tw-object-contain",src:ea.value,alt:"captcha",onClick:la},null,8,T))])),_:1})])]),j(m,null,{default:k((()=>[j(u,{class:"tw-w-full",type:"primary",disabled:q(da),loading:q(B),"native-type":"submit"},{default:k((()=>[j(O,{"enter-active-class":"animate__animated animate__heartBeat animate__faster","leave-active-class":"animate__animated animate__fadeOut animate__faster",mode:"out-in",onAfterEnter:va,onEnterCancelled:va},{default:k((()=>[q(A)?(h(),E(d,{key:0})):(h(),y("span",U,L(q(Z)),1))])),_:1})])),_:1},8,["disabled","loading"])])),_:1})])),_:1},8,["onSubmit"])])],2)],2)}}}),Y={};Y.$style=A,"function"==typeof B&&B(X);var Z=W(X,[["__cssModules",Y]]);export{Z as default};
