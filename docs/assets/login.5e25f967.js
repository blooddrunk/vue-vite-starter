var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{p as r,aZ as i,d as u,l as c,bj as p,n as d,o as m,a as v,e as f,L as b,a4 as w,ba as g,aq as h,a7 as y,a8 as x,t as _,g as C,ag as j,ac as k,bk as $,ae as L,f as A,w as I}from"./vendor.e60456f3.js";import{C as O}from"./index.7e4216b6.js";import{u as V}from"./useFormField.8c305caf.js";import{_ as B,a as E}from"./index.a9a156c1.js";import"./index.9bc79dd0.js";import{T as P}from"./function-call.7be5e6a9.js";import{B as S}from"./index.e74be4f5.js";import"./index.84f5d824.js";import"./on-popup-reopen.d93741ed.js";import"./interceptor.f210eca8.js";var F={input:"_input_77e7o_2",control:"_control_77e7o_5",controlActive:"_controlActive_77e7o_29",labelActive:"_labelActive_77e7o_42"};const U=["for"],q=["id","value","placeholder"],M={key:1,class:"tw-ml-auto tw-pl-1 tw-flex-shrink-0"},T={key:0,class:"tw-absolute tw-top-full tw-left-0"},z={class:"tw-px-2 tw-text-xs tw-text-red-500 tw-font-medium tw-leading-none"},D=u({inheritAttrs:!1}),X=u((Z=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&n(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&n(e,t,a[t]);return e})({},D),G={props:{name:null,label:{default:""},showLabel:{type:Boolean,default:!1},placeholder:{default:""},showValidationError:{type:Boolean,default:!0},wrapperClass:{default:void 0}},emits:["focus","blur","input","change"],setup(e,{emit:a}){const t=e,l=c(null),o=p(),s=d((()=>!(!o.label&&!t.label))),{listeners:n,errorMessage:r,value:i,meta:u}=V({name:t.name,label:t.label}),j=c(!1),k=()=>{j.value=!0,a("focus")},$=e=>{n.value.onBlur(e),j.value=!1,a("blur")},L=e=>{n.value["onUpdate:modelValue"](e),a("input",e.target.value)},A=e=>{n.value.onChange(e),a("change",e.target.value)},I=d((()=>j.value||u.dirty&&i.value||t.placeholder));return(a,t)=>(m(),v("div",{class:w([a.$style.input,e.wrapperClass,e.showValidationError&&"tw-relative tw-mb-4"])},[f("div",{class:w({[a.$style.control]:!0,[a.$style.controlActive]:j.value})},[e.showLabel&&b(s)?(m(),v("label",{key:0,class:w({[a.$style.labelActive]:b(I)}),for:e.name,onClick:t[0]||(t[0]=e=>l.value.focus()),onTouchstart:t[1]||(t[1]=g((e=>l.value.focus()),["stop"]))},[h(a.$slots,"label",{},(()=>[f("span",null,_(e.label),1)]))],42,U)):y("",!0),f("input",x({id:e.name,ref_key:"input",ref:l,value:b(i),placeholder:e.placeholder},a.$attrs,{onFocus:k,onBlur:$,onInput:L,onChange:A}),null,16,q),a.$slots.append?(m(),v("div",M,[h(a.$slots,"append")])):y("",!0)],2),e.showValidationError&&b(r)?(m(),v("p",T,[f("span",z,[h(a.$slots,"error",{error:b(r)},(()=>[C(_(b(r)),1)]))])])):y("",!0)],2))}},a(Z,t(G))));var Z,G;const H={};H.$style=F;var J=B(X,[["__cssModules",H]]),K={};const N={class:"tw-flex tw-flex-col tw-h-screen tw-pt-[15vh] tw-pb-8 tw-px-8"},Q=f("header",null,[f("h3",{class:"tw-py-3 tw-text-2xl tw-font-bold"},"手机快捷登录"),f("p",{class:"tw-text-sm tw-text-medium"},"未注册过的手机号将自动创建账号")],-1),R=["onClick"],W={class:"tw-mt-16 tw-text-center"},Y={class:"tw-mt-auto tw-flex tw-justify-center tw-text-xs"},ee=C(" 登录即代表同意 "),ae=C(" 和 "),te=u({setup(e){var a,t,l;const o=E();j((()=>o.loginError),(e=>{e&&P.fail(e)}));const{values:s,validateField:n,isSubmitting:u,handleSubmit:p}=k({validationSchema:{mobile:"required|mobile",authCode:"required|numeric|max:6"},initialValues:{mobile:null!=(a=o.stagedLoginInfo.mobile)?a:"",authCode:null!=(t=o.stagedLoginInfo.authCode)?t:""}});o.$patch((e=>{e.stagedLoginInfo.mobile="",e.stagedLoginInfo.authCode=""}));const h=c(10),{isActive:y,pause:x,resume:V}=$((()=>{h.value--,h.value<=0&&x()}),1e3,{immediate:!1,immediateCallback:!0}),B=d((()=>y.value?`${h.value}s后重新获取`:"获取验证码")),F=async()=>{const{valid:e}=await n("mobile");e&&(y.value||(h.value=10,await(async e=>(await r(1e3),i(1e3)))(s.mobile),P("验证码已发送"),V()))},U=c(null!=(l=o.stagedLoginInfo.isUserAgreementChecked)&&l),q=c(""),M=()=>{q.value=""},T=L(),z=e=>{o.$patch((e=>{e.stagedLoginInfo.mobile=s.mobile,e.stagedLoginInfo.authCode=s.authCode,e.stagedLoginInfo.isUserAgreementChecked=U.value})),T.push({name:e})},D=p((async e=>{if(!U.value)return P("请先阅读并同意用户协议和隐私政策"),void(q.value="animate__animated animate__shakeX");q.value="",await o.login(e),o.isLoggedIn&&T.replace({name:"mobile"})}));return(e,a)=>{const t=J,l=S,o=O;return m(),v("article",N,[Q,f("form",{class:"tw-mt-12",onSubmit:a[0]||(a[0]=g((()=>{}),["prevent"]))},[A(t,{name:"mobile",label:"手机号",type:"text",inputmode:"numeric",maxlength:"11",pattern:"^1\\d{10}",placeholder:"请输入手机号"}),A(t,{name:"authCode",label:"验证码",type:"text",inputmode:"numeric",autocomplete:"one-time-code",maxlength:"6",pattern:"\\d{6}",placeholder:"请输入验证码"},{append:I((()=>[f("a",{class:w(b(y)?"tw-text-slate-400/75":"tw-text-primary"),onClick:g(F,["prevent"])},_(b(B)),11,R)])),_:1}),f("div",W,[A(l,{class:"tw-w-11/12",type:"primary",round:"",loading:b(u),onClick:b(D)},{default:I((()=>[C(_(b(u)?"登录中...":"登录"),1)])),_:1},8,["loading","onClick"])])],32),f("footer",Y,[A(o,{modelValue:U.value,"onUpdate:modelValue":a[3]||(a[3]=e=>U.value=e),class:w(q.value),"icon-size":"16px",onAnimationend:M},{default:I((()=>[f("span",null,[ee,f("a",{class:"tw-text-primary",onClick:a[1]||(a[1]=g((e=>z("mobile-user-agreement")),["prevent"]))}," 《用户协议》 "),ae,f("a",{class:"tw-text-primary",onClick:a[2]||(a[2]=g((e=>z("mobile-privacy-policy")),["prevent"]))}," 《隐私政策》 ")])])),_:1},8,["modelValue","class"])])])}}});"function"==typeof K&&K(te);export{te as default};
