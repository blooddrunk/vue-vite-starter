import{d as e,l as a,n as t,ag as l,f as s,a6 as i,aT as n,a8 as o,aU as u,aV as r,o as d,a as c,e as m,aW as p,aX as g,c as v,w,L as f,aY as h,a7 as b,t as y,b as x,F as k}from"./vendor.cae3e354.js";import{B as V}from"./index.c867298c.js";import{S as B,u as S,I as T}from"./cart.ece30a59.js";import{C as I}from"./index.be5e4b0a.js";import{_ as P}from"./index.a2230fa5.js";import{a as q,u as C,T as M}from"./function-call.9a037c21.js";import{a as W,g as j,h as U,p as z,H as F,c as L,l as E,t as N,n as _,o as H,q as R,s as X,v as A,w as D,x as Y,y as G,z as J}from"./index.b05a476a.js";import{c as K}from"./interceptor.8fc59063.js";var[O,Q]=L("stepper"),Z=(e,a)=>String(e)===String(a),$=D(e({name:O,props:{min:E(1),max:E(1/0),name:E(""),step:E(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:N,showMinus:N,showInput:N,longPress:N,allowEmpty:Boolean,modelValue:_,inputWidth:_,buttonSize:_,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:E(1),decimalLength:_},emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,r){var d,c,m,p,g,v,{emit:w}=r,f=a=>{var{min:t,max:l,allowEmpty:s,decimalLength:i}=e;return s&&""===a||(a=""===(a=H(String(a),!e.integer))?0:+a,a=Number.isNaN(a)?+t:a,a=Math.max(Math.min(+l,a),+t),R(i)&&(a=a.toFixed(+i))),a},h=a(),b=a((m=null!=(c=e.modelValue)?c:e.defaultValue,p=f(m),Z(p,e.modelValue)||w("update:modelValue",p),p)),y=t((()=>e.disabled||e.disableMinus||b.value<=+e.min)),x=t((()=>e.disabled||e.disablePlus||b.value>=+e.max)),k=t((()=>({width:W(e.inputWidth),height:W(e.buttonSize)}))),V=t((()=>j(e.buttonSize))),B=a=>{e.beforeChange?K(e.beforeChange,{args:[a],done(){b.value=a}}):b.value=a},S=()=>{if("plus"===d&&x.value||"minus"===d&&y.value)w("overlimit",d);else{var a="minus"===d?-e.step:+e.step,t=f(X(+b.value,a));B(t),w(d)}},T=a=>{var t=a.target,{value:l}=t,{decimalLength:s}=e,i=H(String(l),!e.integer);if(R(s)&&i.includes(".")){var n=i.split(".");i=n[0]+"."+n[1].slice(0,+s)}e.beforeChange?t.value=String(b.value):Z(l,i)||(t.value=i);var o=i===String(+i);B(o?+i:i)},I=a=>{var t;e.disableInput?null==(t=h.value)||t.blur():w("focus",a)},P=e=>{var a=e.target,t=f(a.value);a.value=String(t),b.value=t,u((()=>{w("blur",e),A()}))},q=()=>{v=setTimeout((()=>{S(),q()}),200)},C=a=>{e.longPress&&(clearTimeout(v),g&&z(a))},M=a=>{e.disableInput&&z(a)},L=a=>({onClick:e=>{z(e),d=a,S()},onTouchstart:()=>{d=a,e.longPress&&(g=!1,clearTimeout(v),v=setTimeout((()=>{g=!0,S(),q()}),600))},onTouchend:C,onTouchcancel:C});return l((()=>[e.max,e.min,e.integer,e.decimalLength]),(()=>{var e=f(b.value);Z(e,b.value)||(b.value=e)})),l((()=>e.modelValue),(e=>{Z(e,b.value)||(b.value=f(e))})),l(b,(a=>{w("update:modelValue",a),w("change",a,{name:e.name})})),U((()=>e.modelValue)),()=>s("div",{role:"group",class:Q([e.theme])},[i(s("button",o({type:"button",style:V.value,class:[Q("minus",{disabled:y.value}),{[F]:!y.value}],"aria-disabled":y.value||void 0},L("minus")),null),[[n,e.showMinus]]),i(s("input",{ref:h,type:e.integer?"tel":"text",role:"spinbutton",class:Q("input"),value:b.value,style:k.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":b.value,onBlur:P,onInput:T,onFocus:I,onMousedown:M},null),[[n,e.showInput]]),i(s("button",o({type:"button",style:V.value,class:[Q("plus",{disabled:x.value}),{[F]:!x.value}],"aria-disabled":x.value||void 0},L("plus")),null),[[n,e.showPlus]])])}})),[ee,ae]=L("swipe-cell"),te=D(e({name:ee,props:{name:E(""),disabled:Boolean,leftWidth:_,rightWidth:_,beforeClose:Function,stopPropagation:Boolean},emits:["open","close","click"],setup(e,l){var i,n,o,{emit:u,slots:d}=l,c=a(),m=a(),p=a(),g=r({offset:0,dragging:!1}),v=q(),w=e=>e.value?Y(e).width:0,f=t((()=>R(e.leftWidth)?+e.leftWidth:w(m))),h=t((()=>R(e.rightWidth)?+e.rightWidth:w(p))),b=a=>{i=!0,g.offset="left"===a?f.value:-h.value,u("open",{name:e.name,position:a})},y=a=>{g.offset=0,i&&(i=!1,u("close",{name:e.name,position:a}))},x=a=>{e.disabled||(o=g.offset,v.start(a))},k=a=>{if(!e.disabled){var{deltaX:t}=v;if(v.move(a),v.isHorizontal())n=!0,g.dragging=!0,(!i||t.value*o<0)&&z(a,e.stopPropagation),g.offset=J(t.value+o,-h.value,f.value)}},V=()=>{var e,a,t,l;g.dragging&&(g.dragging=!1,e=g.offset>0?"left":"right",a=Math.abs(g.offset),t=i?.85:.15,(l="left"===e?f.value:h.value)&&a>l*t?b(e):y(e),setTimeout((()=>{n=!1}),0))},B=function(a){void 0===a&&(a="outside"),u("click",a),i&&!n&&K(e.beforeClose,{args:[{name:e.name,position:a}],done:()=>y(a)})},S=(e,a)=>t=>{a&&t.stopPropagation(),B(e)},T=(e,a)=>{var t=d[e];if(t)return s("div",{ref:a,class:ae(e),onClick:S(e,!0)},[t()])};return C({open:b,close:y}),G(c,(()=>B("outside")),{eventName:"touchstart"}),()=>{var e={transform:"translate3d("+g.offset+"px, 0, 0)",transitionDuration:g.dragging?"0s":".6s"};return s("div",{ref:c,class:ae(),onClick:S("cell"),onTouchstart:x,onTouchmove:k,onTouchend:V,onTouchcancel:V},[s("div",{class:ae("wrapper"),style:e},[T("left",m),null==d.default?void 0:d.default(),T("right",p)])])}}}));const le={},se={class:"tw-p-2 tw-mt-3 tw-bg-white tw-rounded-md tw-shadow tw-shadow-light tw-grid tw-grid-cols-7 tw-items-center"},ie=m("div",{class:"tw-col-span-2"},[m("div",{class:"tw-bg-light tw-rounded tw-w-full tw-aspect-w-1 tw-aspect-h-1"})],-1);var ne=P(le,[["render",function(e,a){const t=B;return d(),c("div",se,[ie,s(t,{class:"tw-col-span-5",title:"",row:3})])}]]);const oe={class:"tw-p-2 tw-mt-3 tw-bg-white tw-rounded-md tw-shadow tw-shadow-light tw-flex tw-items-center"},ue={class:"tw-flex-grow tw-grid tw-grid-cols-7 tw-items-center tw-gap-3"},re={class:"tw-col-span-5 tw-self-start"},de={class:"tw-line-clamp-3 tw-break-all tw-text-medium tw-leading-none"},ce={class:"tw-inline tw-text-dark"},me={class:"tw-ml-2 tw-text-xs tw-text-light"},pe={class:"tw-mt-2 tw-flex tw-items-center"},ge={class:"tw-text-primary tw-font-bold"},ve=m("span",{class:"tw-ml-1 tw-text-primary tw-text-xs"},"元/月",-1),we={key:0,class:"tw-ml-auto tw-text-sm tw-font-semibold"},fe=e({props:{item:null,loading:{type:Boolean,default:!1},checked:{type:Boolean,default:!1},quantity:{default:0},readonly:{type:Boolean,default:!1}},emits:["update:checked","update:quantity"],setup(e,{emit:a}){const t=e,i=p(t,"checked",a),n=p(t,"quantity",a),o=S();l((()=>o.itemPatchingErrorMessage||o.itemRemovingErrorMessage),(e=>{e&&M(e)})),g(n,(()=>{o.patchItem(t.item)}),{debounce:500});const u=async()=>{await o.removeItem(t.item)&&(o.items=o.items.filter((e=>e.id!==t.item.id)))};return(a,t)=>{const l=ne,r=I,p=T,g=$,x=V,k=te;return e.loading?(d(),v(l,{key:0})):(d(),v(k,{key:1},{right:w((()=>[s(x,{square:"",text:"删除",type:"danger",class:"!tw-h-full",loading:f(o).isItemRemoving,onClick:u},null,8,["loading"])])),default:w((()=>[m("div",oe,[e.readonly?b("",!0):(d(),v(r,{key:0,modelValue:f(i),"onUpdate:modelValue":t[0]||(t[0]=e=>h(i)?i.value=e:null),class:"tw-flex-shrink-0 tw-pr-1.5","icon-size":"18px"},null,8,["modelValue"])),m("div",ue,[s(p,{class:"tw-col-span-2 tw-w-full tw-aspect-w-1 tw-aspect-h-1",src:e.item.thumbnail,fit:"cover",round:"",radius:"8px"},null,8,["src"]),m("div",re,[m("div",de,[m("figcaption",ce,y(e.item.title),1),m("span",me,y(e.item.body),1)]),m("div",pe,[m("span",ge,y(e.item.price),1),ve,e.readonly?(d(),c("span",we," x"+y(f(n)),1)):(d(),v(g,{key:1,modelValue:f(n),"onUpdate:modelValue":t[1]||(t[1]=e=>h(n)?n.value=e:null),class:"tw-ml-auto",integer:"",min:"1",max:"99",disabled:f(o).isItemPatching},null,8,["modelValue","disabled"]))])])])])])),_:1}))}}}),he=e({props:{items:null,loading:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},setup(e){const a=[...Array(10).keys()].map((e=>({id:String(e)})));return(t,l)=>{const s=ne,i=fe;return e.loading?(d(!0),c(k,{key:0},x(f(a),(e=>(d(),v(s,{key:e.id})))),128)):(d(!0),c(k,{key:1},x(e.items,(a=>(d(),v(i,{key:a.id,checked:a.checked,"onUpdate:checked":e=>a.checked=e,quantity:a.quantity,"onUpdate:quantity":e=>a.quantity=e,readonly:e.readonly,item:a,loading:e.loading},null,8,["checked","onUpdate:checked","quantity","onUpdate:quantity","readonly","item","loading"])))),128))}}});export{he as _};
