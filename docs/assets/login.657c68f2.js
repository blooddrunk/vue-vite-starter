var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{p as n,a$ as i,d as u,l as c,bc as p,n as m,o as d,a as v,e as f,L as w,a4 as b,b8 as y,aq as h,a7 as x,a8 as _,t as g,g as j,ac as C,bd as k,ag as $,ae as A,r as O,f as V,w as B}from"./vendor.cae3e354.js";import{C as E}from"./index.be5e4b0a.js";import{B as P}from"./index.c867298c.js";import{u as S}from"./useFormField.4fd7f0e2.js";import{_ as F}from"./index.a2230fa5.js";import"./index.4a907a91.js";import{u as L}from"./mobile-auth.a4f4c191.js";import{T as q}from"./function-call.9a037c21.js";import"./index.b05a476a.js";import"./interceptor.8fc59063.js";var I={input:"_input_77e7o_2",control:"_control_77e7o_5",controlActive:"_controlActive_77e7o_29",labelActive:"_labelActive_77e7o_42"};const M=["for"],T=["id","value","placeholder"],U={key:1,class:"tw-ml-auto tw-pl-1 tw-flex-shrink-0"},z={key:0,class:"tw-absolute tw-top-full tw-left-0"},D={class:"tw-px-2 tw-text-xs tw-text-red-500 tw-font-medium tw-leading-none"},X=u({inheritAttrs:!1}),G=u((H=((e,a)=>{for(var t in a||(a={}))o.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&r(e,t,a[t]);return e})({},X),J={props:{name:null,label:{default:""},showLabel:{type:Boolean,default:!1},placeholder:{default:""},showValidationError:{type:Boolean,default:!0},wrapperClass:{default:void 0}},emits:["focus","blur","input","change"],setup(e,{emit:a}){const t=e,l=c(null),o=p(),s=m((()=>!(!o.label&&!t.label))),{listeners:r,errorMessage:n,value:i,meta:u}=S({name:t.name,label:t.label}),C=c(!1),k=()=>{C.value=!0,a("focus")},$=e=>{r.value.onBlur(e),C.value=!1,a("blur")},A=e=>{r.value["onUpdate:modelValue"](e),a("input",e.target.value)},O=e=>{r.value.onChange(e),a("change",e.target.value)},V=m((()=>C.value||u.dirty&&i.value||t.placeholder));return(a,t)=>(d(),v("div",{class:b([a.$style.input,e.wrapperClass,e.showValidationError&&"tw-relative tw-mb-4"])},[f("div",{class:b({[a.$style.control]:!0,[a.$style.controlActive]:C.value})},[e.showLabel&&w(s)?(d(),v("label",{key:0,class:b({[a.$style.labelActive]:w(V)}),for:e.name,onClick:t[0]||(t[0]=e=>l.value.focus()),onTouchstart:t[1]||(t[1]=y((e=>l.value.focus()),["stop"]))},[h(a.$slots,"label",{},(()=>[f("span",null,g(e.label),1)]))],42,M)):x("",!0),f("input",_({id:e.name,ref_key:"input",ref:l,value:w(i),placeholder:e.placeholder},a.$attrs,{onFocus:k,onBlur:$,onInput:A,onChange:O}),null,16,T),a.$slots.append?(d(),v("div",U,[h(a.$slots,"append")])):x("",!0)],2),e.showValidationError&&w(n)?(d(),v("p",z,[f("span",D,[h(a.$slots,"error",{error:w(n)},(()=>[j(g(w(n)),1)]))])])):x("",!0)],2))}},a(H,t(J))));var H,J;const K={};K.$style=I;var N=F(G,[["__cssModules",K]]),Q={};const R={class:"tw-flex tw-flex-col tw-h-screen tw-pt-[15vh] tw-pb-8 tw-px-8"},W=f("header",null,[f("h3",{class:"tw-py-3 tw-text-2xl tw-font-bold"},"手机快捷登录"),f("p",{class:"tw-text-sm tw-text-medium"},"未注册过的手机号将自动创建账号")],-1),Y=["onClick"],Z={class:"tw-mt-16 tw-text-center"},ee={class:"tw-mt-auto tw-flex tw-justify-center tw-text-xs"},ae={class:""},te=j(" 登录即代表同意 "),le=j(" 《用户协议》 "),oe=j(" 和 "),se=j(" 《隐私政策》 "),re=u({setup(e){const{values:a,validateField:t,isSubmitting:l,handleSubmit:o}=C({validationSchema:{mobile:"required|mobile",authCode:"required|numeric|max:6"},initialValues:{mobile:"",authCode:""}}),s=c(10),{isActive:r,pause:u,resume:p}=k((()=>{s.value--,s.value<=0&&u()}),1e3,{immediate:!1,immediateCallback:!0}),h=m((()=>r.value?`${s.value}s后重新获取`:"获取验证码")),x=async()=>{const{valid:e}=await t("mobile");e&&(r.value||(s.value=10,await(async e=>(await n(1e3),i(1e3)))(a.mobile),p()))},_=c(!1),S=c(""),F=()=>{S.value=""},I=L();$((()=>I.loginError),(e=>{e&&q.fail(e)}));const M=A(),T=o((async e=>{if(!_.value)return q("请先阅读并同意用户协议和隐私政策"),void(S.value="animate__animated animate__shakeX");S.value="",await I.login(e),I.isLoggedIn&&M.replace({name:"mobile"})}));return(e,a)=>{const t=N,o=P,s=O("router-link"),n=E;return d(),v("article",R,[W,f("form",{class:"tw-mt-12",onSubmit:a[0]||(a[0]=y((()=>{}),["prevent"]))},[V(t,{name:"mobile",label:"手机号",type:"text",inputmode:"numeric",maxlength:"11",pattern:"^1\\d{10}",placeholder:"请输入手机号"}),V(t,{name:"authCode",label:"验证码",type:"text",inputmode:"numeric",autocomplete:"one-time-code",maxlength:"6",pattern:"\\d{6}",placeholder:"请输入验证码"},{append:B((()=>[f("a",{class:b(w(r)?"tw-text-slate-400/75":"tw-text-primary"),onClick:y(x,["prevent"])},g(w(h)),11,Y)])),_:1}),f("div",Z,[V(o,{class:"tw-w-11/12",type:"primary",round:"",loading:w(l),onClick:w(T)},{default:B((()=>[j(g(w(l)?"登录中...":"登录"),1)])),_:1},8,["loading","onClick"])])],32),f("footer",ee,[V(n,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),class:b(S.value),"icon-size":"16px",onAnimationend:F},{default:B((()=>[f("span",ae,[te,V(s,{class:"tw-text-primary",to:"/mobile/user-agreement"},{default:B((()=>[le])),_:1}),oe,V(s,{class:"tw-text-primary",to:"/mobile/privacy-policy"},{default:B((()=>[se])),_:1})])])),_:1},8,["modelValue","class"])])])}}});"function"==typeof Q&&Q(re);export{re as default};
