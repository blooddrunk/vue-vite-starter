import{d as e,f as a,l,F as t,aV as o,n as r,ag as s,a6 as n,aY as i,aX as d}from"./vendor.e60456f3.js";import{u}from"./on-popup-reopen.d93741ed.js";import{A as c}from"./index.13efafc2.js";import{C as m}from"./index.0eef1764.js";import{q as v,c as h,n as p,t as f,m as g,F as b,p as w,w as y,v as C,j as V,a as B,f as x,e as D,l as S,x as A,y as k}from"./index.84f5d824.js";import{F}from"./index.b20c409a.js";import{P as R,T as j}from"./function-call.7be5e6a9.js";import{L as P,B as E}from"./index.e74be4f5.js";var[T,L]=h("form"),M=y(e({name:T,props:{colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:p,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:f,validateTrigger:g("onBlur"),showErrorMessage:f,errorMessageAlign:String},emits:["submit","failed"],setup(e,l){var{emit:t,slots:o}=l,{children:r,linkChildren:s}=v(b),n=e=>e?r.filter((a=>e.includes(a.name))):r,i=a=>{return"string"==typeof a?(e=>{var a=r.find((a=>a.name===e));return a?new Promise(((e,l)=>{a.validate().then((a=>{a?l(a):e()}))})):Promise.reject()})(a):e.validateFirst?(l=a,new Promise(((e,a)=>{var t=[];n(l).reduce(((e,a)=>e.then((()=>{if(!t.length)return a.validate().then((e=>{e&&t.push(e)}))}))),Promise.resolve()).then((()=>{t.length?a(t):e()}))}))):(e=>new Promise(((a,l)=>{var t=n(e);Promise.all(t.map((e=>e.validate()))).then((e=>{(e=e.filter(Boolean)).length?l(e):a()}))})))(a);var l},d=(e,a)=>{r.some((l=>l.name===e&&(l.$el.scrollIntoView(a),!0)))},c=()=>{var a=r.reduce(((e,a)=>(e[a.name]=a.formValue.value,e)),{});i().then((()=>t("submit",a))).catch((l=>{t("failed",{values:a,errors:l}),e.scrollToError&&l[0].name&&d(l[0].name)}))},m=e=>{w(e),c()};return s({props:e}),u({submit:c,validate:i,scrollToField:d,resetValidation:e=>{"string"==typeof e&&(e=[e]),n(e).forEach((e=>{e.resetValidation()}))}}),()=>a("form",{class:L(),onSubmit:m},[null==o.default?void 0:o.default()])}})),[z,I]=h("switch"),U=y(e({name:z,props:{size:p,loading:Boolean,disabled:Boolean,modelValue:B,activeColor:String,inactiveColor:String,activeValue:{type:B,default:!0},inactiveValue:{type:B,default:!1}},emits:["change","update:modelValue"],setup(e,l){var{emit:t}=l,o=()=>e.modelValue===e.activeValue,r=()=>{if(!e.disabled&&!e.loading){var a=o()?e.inactiveValue:e.activeValue;t("update:modelValue",a),t("change",a)}},s=()=>{if(e.loading){var l=o()?e.activeColor:e.inactiveColor;return a(P,{class:I("loading"),color:l},null)}};return C((()=>e.modelValue)),()=>{var{size:l,loading:t,disabled:n,activeColor:i,inactiveColor:d}=e,u=o(),c={fontSize:V(l),backgroundColor:u?i:d};return a("div",{role:"switch",class:I({on:u,loading:t,disabled:n}),style:c,tabindex:n?void 0:0,"aria-checked":u,onClick:r},[a("div",{class:I("node")},[s()])])}}})),[O,$,q]=h("address-edit-detail"),H=e({name:O,props:{show:Boolean,rows:p,value:String,rules:Array,focused:Boolean,maxlength:p,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","select-search"],setup(e,o){var{emit:r}=o,s=l(),n=()=>e.focused&&e.searchResult&&e.showSearchResult,i=()=>{if(n()){var{searchResult:l}=e;return l.map((l=>a(m,{clickable:!0,key:l.name+l.address,icon:"location-o",label:l.address,class:$("search-item"),border:!1,onClick:()=>(e=>{r("select-search",e),r("input",((e.address||"")+" "+(e.name||"")).trim())})(l)},{title:()=>(l=>{if(l.name){var t=l.name.replace(e.value,"<span class="+$("keyword")+">"+e.value+"</span>");return a("div",{innerHTML:t},null)}})(l)})))}},d=e=>r("blur",e),u=e=>r("focus",e),c=e=>r("input",e);return()=>{if(e.show)return a(t,null,[a(F,{autosize:!0,clearable:!0,ref:s,class:$(),rows:e.rows,type:"textarea",rules:e.rules,label:q("label"),border:!n(),maxlength:e.maxlength,modelValue:e.value,placeholder:q("placeholder"),onBlur:d,onFocus:u,"onUpdate:modelValue":c},null),i()])}}}),[W,X,Y]=h("address-edit"),G={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,postalCode:"",addressDetail:""},J=y(e({name:W,props:{areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:f,showDetail:f,showDelete:Boolean,showPostal:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:p,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:S(1),detailMaxlength:S(200),areaColumnsPlaceholder:A(),addressInfo:{type:Object,default:()=>D({},G)},telValidator:{type:Function,default:k},postalValidator:{type:Function,default:e=>/^\d{6}$/.test(e)}},emits:["save","focus","delete","click-area","change-area","change-detail","select-search","change-default"],setup(e,t){var{emit:v,slots:h}=t,p=l(),f=o({}),g=l(!1),b=l(!1),w=r((()=>x(e.areaList)&&Object.keys(e.areaList).length)),y=r((()=>{var{country:e,province:a,city:l,county:t,areaCode:o}=f;if(o){var r=[e,a,l,t];return a&&a===l&&r.splice(1,1),r.filter(Boolean).join("/")}return""})),C=r((()=>{var a;return(null==(a=e.searchResult)?void 0:a.length)&&b.value})),V=()=>{if(p.value){var e=p.value.getArea();e.areaCode=e.code,delete e.code,D(f,e)}},B=e=>{b.value="addressDetail"===e,v("focus",e)},S=r((()=>{var{validator:a,telValidator:l,postalValidator:t}=e,o=(e,l)=>({validator:t=>{if(a){var o=a(e,t);if(o)return o}return!!t||l}});return{name:[o("name",Y("nameEmpty"))],tel:[o("tel",Y("telInvalid")),{validator:l,message:Y("telInvalid")}],areaCode:[o("areaCode",Y("areaEmpty"))],addressDetail:[o("addressDetail",Y("addressEmpty"))],postalCode:[o("addressDetail",Y("postalEmpty")),{validator:t,message:Y("postalEmpty")}]}})),A=()=>v("save",f),k=e=>{f.addressDetail=e,v("change-detail",e)},P=e=>{(e=e.filter(Boolean)).some((e=>!e.code))?j(Y("areaEmpty")):(g.value=!1,V(),v("change-area",e))},T=()=>v("delete",f),L=e=>{f.areaCode=e||"",e&&d(V)},z=()=>{setTimeout((()=>{b.value=!1}))},I=()=>{if(e.showSetDefault){var l={"right-icon":()=>a(U,{modelValue:f.isDefault,"onUpdate:modelValue":e=>f.isDefault=e,size:"24",onChange:e=>v("change-default",e)},null)};return n(a(m,{center:!0,title:Y("defaultAddress"),class:X("default")},l),[[i,!C.value]])}};return u({getArea:()=>{var e;return(null==(e=p.value)?void 0:e.getValues())||[]},setAreaCode:L,setAddressDetail:e=>{f.addressDetail=e}}),s((()=>e.areaList),(()=>L(f.areaCode))),s((()=>e.addressInfo),(e=>{D(f,G,e),L(e.areaCode)}),{deep:!0,immediate:!0}),()=>{var{disableArea:l}=e;return a(M,{class:X(),onSubmit:A},{default:()=>[a("div",{class:X("fields")},[a(F,{modelValue:f.name,"onUpdate:modelValue":e=>f.name=e,clearable:!0,label:Y("name"),rules:S.value.name,placeholder:Y("name"),onFocus:()=>B("name")},null),a(F,{modelValue:f.tel,"onUpdate:modelValue":e=>f.tel=e,clearable:!0,type:"tel",label:Y("tel"),rules:S.value.tel,maxlength:e.telMaxlength,placeholder:Y("tel"),onFocus:()=>B("tel")},null),n(a(F,{readonly:!0,label:Y("area"),"is-link":!l,modelValue:y.value,rules:S.value.areaCode,placeholder:e.areaPlaceholder||Y("area"),onFocus:()=>B("areaCode"),onClick:()=>{v("click-area"),g.value=!l}},null),[[i,e.showArea]]),a(H,{show:e.showDetail,rows:e.detailRows,rules:S.value.addressDetail,value:f.addressDetail,focused:b.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:z,onFocus:()=>B("addressDetail"),onInput:k,"onSelect-search":e=>v("select-search",e)},null),e.showPostal&&n(a(F,{modelValue:f.postalCode,"onUpdate:modelValue":e=>f.postalCode=e,type:"tel",rules:S.value.postalCode,label:Y("postal"),maxlength:"6",placeholder:Y("postal"),onFocus:()=>B("postalCode")},null),[[i,!C.value]]),null==h.default?void 0:h.default()]),I(),n(a("div",{class:X("buttons")},[a(E,{block:!0,round:!0,type:"danger",text:e.saveButtonText||Y("save"),class:X("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&a(E,{block:!0,round:!0,class:X("button"),loading:e.isDeleting,text:e.deleteButtonText||Y("delete"),onClick:T},null)]),[[i,!C.value]]),a(R,{show:g.value,"onUpdate:show":e=>g.value=e,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[a(c,{ref:p,value:f.areaCode,loading:!w.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:P,onCancel:()=>{g.value=!1}},null)]})]})}}}));export{J as A};
